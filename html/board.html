<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>Î∂àÎ∞© Í≤åÏãúÌåê</title>
  <link href="https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts-nine@1.0/NanumGothicCoding.woff2" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
  <style>
    @keyframes scrollText {
      0% { transform: translateX(0%); }
      100% { transform: translateX(-50%); }
    }
    #textBanner {
      background-color: #000;
      color: #adff6a;
      font-family: 'Press Start 2P', cursive;
      overflow: hidden;
    }
    .text-slide-wrap {
      width: 100%;
      white-space: nowrap;
    }
    .text-slide-track {
      display: inline-block;
      padding: 7px 0;
      animation: scrollText 50s linear infinite;
    }
    .text-slide-track span {
      display: inline-block;
      margin: 0 3rem;
      font-size: 0.7rem;
    }
    a { color: #0000cc; text-decoration: none; }
    a:hover { color: #ff2929; }
    body {
      font-family:'Nanum Gothic Coding', monospace;
      text-align: center;
      background-color: hsl(0, 0%, 79%);
      color: #003cff;
      line-height: 1.6;
      margin: 0;
      padding: 0;
    }
    h2 {
      font-family: 'Press Start 2P', cursive;
      font-size: 1.5rem;
      margin-top: 30px;
    }
    table {
      margin: auto;
      border-collapse: collapse;
      width: 90%;
      background-color: #fff;
      font-size: 0.85rem;
    }
    th, td {
      border: 0.5px solid #ccc;
      padding: 2px;
    }
    .modal {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background-color: rgba(0,0,0,0.6);
      z-index: 1000;
    }
    .modal-content {
      background: white;
      padding: 20px;
      margin: 5% auto;
      width: 90%;
      max-width: 600px;
      border-radius: 8px;
      text-align: left;
      max-height: 80vh;
      overflow-y: auto;
    }
    #modalImage {
      display: block;
      max-width: 100%;
      margin: 10px auto;
      border-radius: 8px;
    }
    .retro-box {
      max-width: 700px;
      margin: 3rem auto;
      padding: 1.8rem;
      background-color: #a9e4ff;
      border: 2px solid #000;
      box-shadow: 3px 3px 0px #000;
      position: relative;
    }
    .retro-box::before {
      content: "üìÅ BBS";
      position: absolute;
      top: -14px;
      left: 12px;
      background: #fff8dc;
      font-size: 0.8rem;
      padding: 0 4px;
      color: #444;
      border: 1px solid #999;
      font-family: 'Press Start 2P', cursive;
    }
    .home-button {
      position: fixed;
      top: 9px;
      left: 15px;
      background-color: #ffffff;
      color: #000;
      padding: 3px 5px;
      font-size: 0.5rem;
      border: 1px solid #000;
      font-family: 'Press Start 2P', 'Nanum Gothic Coding';
      z-index: 10000;
    }
    .home-button:hover {
      background-color: #ffe600;
      color: #000;
    }
    #pagination {
      margin: 1rem auto;
    }
    #pagination button {
      margin: 0 5px;
      padding: 4px 10px;
    }
  </style>
</head>
<body>
<a href="/boolbang.github.io/" class="home-button">üè† HOME</a>
<div id="textBanner">
  <div class="text-slide-wrap">
    <div class="text-slide-track">
      <span>VIDEO</span><span>GAME</span><span>SOFTWERE</span><span>GRAPHICS</span>
      <span>WEB</span><span>INTERACTIVE</span><span>DRAWING</span>
      <span>VIDEO</span><span>GAME</span><span>SOFTWERE</span><span>GRAPHICS</span>
    </div>
  </div>
</div>
<h2>Portfolio Board</h2>
<div class="retro-box">
  <table id="postTable">
    <thead>
      <tr>
        <th>Î≤àÌò∏</th>
        <th>Ï†úÎ™©</th>
        <th>ÏûëÏÑ±Ïûê</th>
        <th>ÎÇ†Ïßú</th>
        <th>Ï°∞Ìöå</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
  <div id="pagination"></div>
</div>
<div id="postModal" class="modal">
  <div class="modal-content">
    <h3 id="modalTitle"></h3>
    <p><strong>ÏûëÏÑ±Ïûê:</strong> <span id="modalAuthor"></span></p>
    <p><strong>ÎÇ†Ïßú:</strong> <span id="modalDate"></span></p>
    <p id="modalContent"></p>
    <div id="postPagination" style="text-align: center; margin-top: 10px;"></div>
    <img id="modalImage" src="" alt="Ïù¥ÎØ∏ÏßÄ" />
    <br>
    <div style="text-align: center; margin-top: 20px;">
    <button onclick="closeModal()">Îã´Í∏∞</button>
  </div>
</div>
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js";
import { getFirestore, collection, getDocs, doc, updateDoc } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCqAQCELh1q2pWxrXtx-8lBwRe2CTSG_HdQ",
  authDomain: "boolbang-board.firebaseapp.com",
  projectId: "boolbang-board",
  storageBucket: "boolbang-board.appspot.com",
  messagingSenderId: "1563061617526",
  appId: "1:1563061617526:web:066768f311fc53cd017257",
  measurementId: "G-2CBKFZ5Q85"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

let postList = [];
let currentPostPages = [], currentPostPageIndex = 0;
let currentViewDocId = null;
let currentPage = 1;
const postsPerPage = 10;

async function loadPosts() {
  const snapshot = await getDocs(collection(db, "posts"));
  postList = [];
  snapshot.forEach(doc => {
    const data = doc.data();
    postList.push({ id: doc.id, ...data });
  });
  postList.sort((a, b) => new Date(b.date) - new Date(a.date));
  renderPosts();
}

function renderPosts() {
  const tbody = document.querySelector('#postTable tbody');
  tbody.innerHTML = '';
  const start = (currentPage - 1) * postsPerPage;
  const paginatedPosts = postList.slice(start, start + postsPerPage);
  paginatedPosts.forEach((post, i) => {
    const row = document.createElement('tr');
    row.innerHTML = `
      <td>${postList.length - (start + i)}</td>
      <td><a href="#" onclick="viewPost('${post.id}')">${post.title}</a></td>
      <td>${post.author}</td>
      <td>${post.date}</td>
      <td>${post.views}</td>
    `;
    tbody.appendChild(row);
  });
  renderPaginationControls();
}

function renderPaginationControls() {
  const totalPages = Math.ceil(postList.length / postsPerPage);
  const container = document.getElementById('pagination');
  container.innerHTML = '';
  if (totalPages <= 1) return;
  if (currentPage > 1) {
    const prev = document.createElement('button');
    prev.textContent = 'Ïù¥Ï†Ñ';
    prev.onclick = () => { currentPage--; renderPosts(); };
    container.appendChild(prev);
  }
  container.append(`${currentPage} / ${totalPages}`);
  if (currentPage < totalPages) {
    const next = document.createElement('button');
    next.textContent = 'Îã§Ïùå';
    next.onclick = () => { currentPage++; renderPosts(); };
    container.appendChild(next);
  }
}

async function viewPost(id) {
  const post = postList.find(p => p.id === id);
  if (!post) return;
  currentViewDocId = id;
  await updateDoc(doc(db, "posts", id), { views: (post.views || 0) + 1 });
  post.views++;
  renderPosts();
  currentPostPages = (post.content || '').split(/\[\[PAGE\]\]/i).map(parseMedia);
  currentPostPageIndex = 0;
  document.getElementById('modalTitle').textContent = post.title;
  document.getElementById('modalAuthor').textContent = post.author;
  document.getElementById('modalDate').textContent = post.date;
  renderPostPage();
  const img = document.getElementById('modalImage');
  if (post.image) { img.src = post.image; img.style.display = 'block'; } else { img.style.display = 'none'; }
  document.getElementById('postModal').style.display = 'block';
}

function renderPostPage() {
  const contentEl = document.getElementById('modalContent');
  contentEl.innerHTML = currentPostPages[currentPostPageIndex] || '';
  const controls = document.getElementById('postPagination');
  controls.innerHTML = '';
  if (currentPostPages.length <= 1) return;
  if (currentPostPageIndex > 0) {
    const prev = document.createElement('button');
    prev.textContent = 'Ïù¥Ï†Ñ';
    prev.onclick = () => { currentPostPageIndex--; renderPostPage(); };
    controls.appendChild(prev);
  }
  controls.append(`${currentPostPageIndex + 1} / ${currentPostPages.length}`);
  if (currentPostPageIndex < currentPostPages.length - 1) {
    const next = document.createElement('button');
    next.textContent = 'Îã§Ïùå';
    next.onclick = () => { currentPostPageIndex++; renderPostPage(); };
    controls.appendChild(next);
  }
}

function closeModal() {
  document.getElementById('postModal').style.display = 'none';
}

function parseMedia(content) {
  let parsed = content.replace(/\n/g, '<br>');
  parsed = parsed.replace(/(https?:\/\/[^\s]+?\.(jpg|png|gif))/gi, '<img src="$1" style="max-width:100%; margin:10px 0;" />');
  parsed = parsed.replace(/https?:\/\/(?:www\.)?youtube\.com\/watch\?v=([\w-]+)/g, '<iframe width="100%" height="315" src="https://www.youtube.com/embed/$1" frameborder="0" allowfullscreen></iframe>');
  parsed = parsed.replace(/https?:\/\/youtu\.be\/([\w-]+)/g, '<iframe width="100%" height="315" src="https://www.youtube.com/embed/$1" frameborder="0" allowfullscreen></iframe>');
  return parsed;
}

window.viewPost = viewPost;
window.closeModal = closeModal;
document.addEventListener('DOMContentLoaded', loadPosts);
</script>
</body>
</html>

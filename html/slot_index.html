<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Slot Machine</title>
  <meta name="description" content="ìŠ¬ë¡¯ë¨¸ì‹  ê²Œì„ í•´ë³¼ë˜ìš”?">
  <style>
    body {
      background-color: #000;
      font-family: 'Pretendard', monospace;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
      text-align: center;
      flex-direction: column;
      transition: all 0.3s ease;
    }

  #slot-machine {
      background-color: #000;
      padding: 20px;
      border-radius: 0;
      box-shadow: 0 0 0px;
      z-index: 10;
      position: relative;
      border: 5px solid;
      background-image: url("../images/backwave.gif");
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      /* ê³ ì • í¬ê¸°ë¡œ í…Œë§ˆ ì „í™˜ì‹œ ë ˆì´ì•„ì›ƒ ë³€í™” ë°©ì§€ */
      min-width: 400px;
      max-width: 400px;
      width: 400px;
      box-sizing: border-box;
    }

    .reel-container {
      display: flex;
      justify-content: center;
      gap: 5px;
      margin-top: 20px;
    }

    .reel {
      width: 60px;
      height: 180px;
      border: 2px solid currentColor;
      background-color: #000000;
      overflow: hidden;
      position: relative;
    }

    .symbol-strip {
      position: absolute;
      top: 0;
      width: 100%;
      transition: top 1s ease-out;
    }

    .symbol {
      width: 100%;
      height: 60px;
      line-height: 60px;
      font-size: 24px;
      text-align: center;
    }

    .yellow-win {
      color: yellow !important;
      font-weight: bold;
    }

    button {
      margin: 5px;
      padding: 7px 10px;
      font-size: 16px;
      border: none;
      cursor: pointer;
      font-family: 'Courier New', monospace;
      transition: all 0.2s ease;
    }

    #result, #money, #stage-info, #spin-count {
      margin-top: 10px;
      font-size: 18px;
      min-height: 24px; /* ê³ ì • ë†’ì´ë¡œ ë ˆì´ì•„ì›ƒ ì•ˆì •í™” */
    }

    #guide {
      margin-top: 20px;
      font-size: 14px;
      min-height: 40px; /* ê³ ì • ë†’ì´ë¡œ ë ˆì´ì•„ì›ƒ ì•ˆì •í™” */
      display: flex;
      flex-direction: column;
      justify-content: center;
    }

    #bet-options {
      margin-top: 10px;
      display: flex;
      align-items: center;
      justify-content: center; 
      gap: 2px;                
      margin-top: 10px;
      
      
      
    }

    /* Theme: x1 (í°ìƒ‰) */
    .theme-x1 {
      color: #02b7ff;
    }
    .theme-x1 #slot-machine {
      border-color: #02b7ff;
    }
    .theme-x1 button {
      background-color: #ff0000;
      color: #000;
    }
    .theme-x1 button:hover {
      background-color: #e100ff;
    }

    /* Theme: x2 (ë…¹ìƒ‰) */
    .theme-x2 {
      color: #0f0;
    }
    .theme-x2 #slot-machine {
      border-color: #0f0;
    }
    .theme-x2 button {
      background-color: #ff0000;
      color: #000;
    }
    .theme-x2 button:hover {
      background-color: #e100ff;
    }

    /* Theme: x5 (ë¹¨ê°„ìƒ‰) */
    .theme-x5 {
      color: #f00;
    }
    .theme-x5 #slot-machine {
      border-color: #f00;
    }
    .theme-x5 button {
      background-color: #f00;
      color: #000;
    }
    .theme-x5 button:hover {
      background-color: #e100ff;
    }

    @keyframes blink {
  0%, 100% { opacity: 1; }
  50% { opacity: 0; }
}

.yellow-win {
  color: rgb(255, 255, 255) !important;
  font-weight: bold;
  animation: blink 0.5s infinite;
}

@keyframes title-blink {
  0%, 100% { opacity: 1; }
  50% { opacity: 0; }
}

#slot-machine h1 {
  animation: title-blink 0.3s infinite;
}

@keyframes crazy-blink {
  0%, 49% { opacity: 1; }
  50%, 100% { opacity: 0; }
}

#slot-machine.crazy-blink {
  animation: crazy-blink 0.2s infinite;
}

#slot-machine.stage-transition {
  background-image: url("../images/stage.gif");
  background-size: cover;
  background-position: center;
  background-repeat: no-repeat;
}

/* ëª¨ë°”ì¼ ë°˜ì‘í˜• */
@media (max-width: 600px) {
  #slot-machine {
    min-width: 90vw;
    max-width: 90vw;
    width: 90vw;
    padding: 15px;
  }

  #result, #money, #stage-info, #spin-count {
    font-size: 16px;
  }

  #guide {
    font-size: 12px;
  }

  button {
    font-size: 14px;
    padding: 6px 8px;
  }
}

  </style>
</head>
<body class="theme-x1">
  <audio id="bgm" src="../BGM/MA_Elena_Anisimova_Night_Movements_Main.mp3" loop></audio>
  <audio id="click-sound" src="../BGM/btn.mp3"></audio>
  <audio id="win-sound" src="../BGM/bonus.mp3"></audio>

  <div id="slot-machine">
    <img src="../images/bluefire.gif" alt="ë¶ˆ" style="width: 40px; vertical-align: middle;" />
    <img src="../images/bluefire.gif" alt="ë¶ˆ" style="width: 40px; vertical-align: middle;" />
    <img src="../images/bluefire.gif" alt="ë¶ˆ" style="width: 40px; vertical-align: middle;" />
    <h1>ì§€ì˜¥ì˜ ìŠ¬ë¡¯ë¨¸ì‹ </h1>
    <div id="stage-info"></div>
    <div id="spin-count"></div>
    <div class="reel-container" id="reels"></div>

    <div id="bet-options">
      
      <button onclick="setBet(1)">1ë°°</button>
      <button onclick="setBet(2)">2ë°°</button>
      <button onclick="setBet(5)">5ë°°</button>
    </div>

    <button id="spin-button">ëŒë ¤!</button>
    <button id="restart-button" style="display:none;">Restart</button>

    <div id="result"></div>
    <div id="money"></div>
    <div id="guide">
      <strong>ë£°:</strong> <span id="symbol-guide"></span>
    </div>
  </div>

  <script>
    const clickSound = document.getElementById('click-sound');
    const winSound = document.getElementById('win-sound');
    

document.querySelectorAll('button').forEach(btn => {
  btn.addEventListener('click', () => {
    clickSound.volume = 0.3
    clickSound.currentTime = 0; // ë§¤ë²ˆ ì²˜ìŒë¶€í„° ì¬ìƒ
    clickSound.play().catch(() => {}); // ëª¨ë°”ì¼ ì œí•œ ë°©ì§€ìš©
  });
});

    const symbols = ['â˜…', 'â™¦', 'â™ ', 'â™£', 'â™¥'];

    // ê¸°ë³¸ ë³´ìƒ í…Œì´ë¸” (Stage 1 ê¸°ì¤€)
    // ê° ìŠ¤í…Œì´ì§€ë§ˆë‹¤ 2ë°°ì”© ì¦ê°€ (ì§€ìˆ˜ì  ì¦ê°€)
    const baseScores = {
      'â˜…': 500,  // ê°€ì¥ ë†’ì€ ë³´ìƒ
      'â™¦': 70,
      'â™ ': 50,
      'â™£': 30,
      'â™¥': 20    // ê°€ì¥ ë‚®ì€ ë³´ìƒ
    };

    // ê²Œì„ ìƒíƒœ ë³€ìˆ˜
    // money: í˜„ì¬ ìê¸ˆ, stage: í˜„ì¬ ìŠ¤í…Œì´ì§€, target: í´ë¦¬ì–´ ëª©í‘œ
    // spinCount: ì´ í”Œë ˆì´ íšŸìˆ˜, betMultiplier: ë² íŒ… ë°°ìœ¨ (1, 2, 5ë°°)
    let money = 100, stage = 1, target = 500, spinCount = 0, betMultiplier = 1;
    let bgmStarted = false;

    const reelsContainer = document.getElementById('reels');
    const resultDisplay = document.getElementById('result');
    const moneyDisplay = document.getElementById('money');
    const spinButton = document.getElementById('spin-button');
    const restartButton = document.getElementById('restart-button');
    const stageInfoDisplay = document.getElementById('stage-info');
    const spinCountDisplay = document.getElementById('spin-count');
    const symbolGuide = document.getElementById('symbol-guide');
    const bgm = document.getElementById('bgm');
    bgm.volume = 0.3;

    const reelCount = 3;
    const rowCount = 3;
    const spinSymbolsCount = 30;
    let strips = [];

    function setBet(x) {
      betMultiplier = x;
      document.body.classList.remove('theme-x1', 'theme-x2', 'theme-x5');
      document.body.classList.add(`theme-x${x}`);
      updateDisplay();
    }

    // í˜„ì¬ ë² íŒ…ê¸ˆ ê³„ì‚° (ì§€ìˆ˜ì  ì¦ê°€)
    // Stage 1: 10ë§Œì›, Stage 2: 20ë§Œì›, Stage 3: 40ë§Œì›, Stage 4: 80ë§Œì›...
    // betMultiplierë¡œ 1ë°°, 2ë°°, 5ë°° ì„ íƒ ê°€ëŠ¥
    function currentBet() {
      return (10 * Math.pow(2, stage - 1)) * betMultiplier;
    }

    // ìŠ¤í…Œì´ì§€ì— ë”°ë¼ ë³´ìƒì„ ì§€ìˆ˜ì ìœ¼ë¡œ ì¦ê°€ (ë² íŒ… ì¦ê°€ì™€ ê· í˜• ë§ì¶¤)
    // Stage 1: ê¸°ë³¸ ë³´ìƒ (â˜…=500)
    // Stage 2: 2ë°° ë³´ìƒ (â˜…=1000)
    // Stage 3: 4ë°° ë³´ìƒ (â˜…=2000)
    // Stage 4: 8ë°° ë³´ìƒ (â˜…=4000)...
    // ì´ì œ ë¬´í•œ ìŠ¤í…Œì´ì§€ í”Œë ˆì´ ê°€ëŠ¥!
    function getScores() {
      const stageMultiplier = Math.pow(2, stage - 1);

      const scores = {};
      for (let symbol in baseScores) {
        scores[symbol] = baseScores[symbol] * stageMultiplier;
      }

      return scores;
    }

    function updateSymbolGuide() {
      const scores = getScores();
      symbolGuide.textContent = symbols.map(s => `${s}=${scores[s] * betMultiplier}`).join(', ');
    }

    function updateStageInfo() {
      const stageMultiplier = Math.pow(2, stage - 1);
      stageInfoDisplay.textContent = `Stage ${stage} | ë¹š: ${target}ë§Œì› | ë³´ìƒë°°ìœ¨: x${stageMultiplier}`;
    }

    function updateDisplay() {
      moneyDisplay.textContent = `ìê¸ˆ: ${money}ë§Œì›`;
      spinCountDisplay.textContent = `ë² íŒ…ê¸ˆì•¡: ${currentBet()}ë§Œì›`;
      updateStageInfo();
      updateSymbolGuide();
    }

    function initReels() {
      reelsContainer.innerHTML = '';
      strips = [];
      for (let col = 0; col < reelCount; col++) {
        const reel = document.createElement('div');
        reel.className = 'reel';
        const strip = document.createElement('div');
        strip.className = 'symbol-strip';
        for (let i = 0; i < spinSymbolsCount; i++) {
          const symbol = document.createElement('div');
          symbol.className = 'symbol';
          symbol.textContent = symbols[Math.floor(Math.random() * symbols.length)];
          strip.appendChild(symbol);
        }
        reel.appendChild(strip);
        reelsContainer.appendChild(reel);
        strips.push(strip);
      }
    }

    function gameOver() {
      resultDisplay.textContent = 'íŒŒì‚°! ì‚¬ì±„ì—…ì ë“±ì¥.';
      spinButton.disabled = true;
      restartButton.style.display = 'inline-block';
    }

    function nextStage() {
      stage++;
      target *= 2;
      resultDisplay.textContent = `âœ”ï¸ ë¹š ê°šìŒ! ë‹¤ìŒ ë¹š: ${target}ë§Œì›`;

      const machine = document.getElementById('slot-machine');
      machine.classList.add('stage-transition');

      setTimeout(() => {
      machine.classList.remove('stage-transition');
      }, 3000); // 3ì´ˆ ë’¤ ìë™ ì œê±°

  updateDisplay();
    }

function spin() {
  const minBet = 10 * Math.pow(2, stage - 1); // 1ë°° ê¸°ì¤€ ë² íŒ…ê¸ˆ
  const bet = minBet * betMultiplier;         // ì‹¤ì œ ë² íŒ…ê¸ˆ

  if (money < minBet) {
    gameOver();
    return;
  }

  if (money < bet) {
    resultDisplay.textContent = 'ì”ì•¡ì´ ë¶€ì¡±í•©ë‹ˆë‹¤. ë°°ìœ¨ì„ ë‚®ì¶°ì£¼ì„¸ìš”.';
    return;
  }

  document.querySelectorAll('.symbol').forEach(el => el.classList.remove('yellow-win'));
  money -= bet;
  spinCount++;
  updateDisplay();
  resultDisplay.textContent = 'ì œë°œ~~';
  spinButton.disabled = true;

  const grid = [[], [], []];
  const targets = [];

  strips.forEach((strip, col) => {
    const maxIndex = spinSymbolsCount - rowCount - 1;
    const targetIndex = Math.floor(Math.random() * maxIndex) + 1;
    const topOffset = -(targetIndex * 60);
    strip.style.transition = 'top 0.9s ease-out';
    strip.style.top = `${topOffset}px`;
    targets.push(targetIndex);
  });

  setTimeout(() => {
    for (let col = 0; col < reelCount; col++) {
      for (let row = 0; row < rowCount; row++) {
        const el = strips[col].children[targets[col] + row];
        grid[col][row] = { value: el.textContent, element: el };
      }
    }

    const lines = [
      [grid[0][0], grid[1][0], grid[2][0]],
      [grid[0][1], grid[1][1], grid[2][1]],
      [grid[0][2], grid[1][2], grid[2][2]],
      [grid[0][0], grid[0][1], grid[0][2]],
      [grid[1][0], grid[1][1], grid[1][2]],
      [grid[2][0], grid[2][1], grid[2][2]],
      [grid[0][0], grid[1][1], grid[2][2]],
      [grid[0][2], grid[1][1], grid[2][0]]
    ];

    let totalWin = 0;
    let winMessages = [];
    const scoreTable = getScores();

    lines.forEach(line => {
      if (line.every(cell => cell.value === line[0].value)) {
        const symbol = line[0].value;
        const winScore = (scoreTable[symbol] || 0) * betMultiplier;
        totalWin += winScore;
        winMessages.push(`${symbol} +${winScore}`);
        line.forEach(cell => cell.element.classList.add('yellow-win'));
    // â˜… ì‹¬ë³¼ ë§ì¶œ ê²½ìš° ì „ì²´ ë°˜ì§ì„ ì¶”ê°€
if (symbol === 'â˜…') {
  const machine = document.getElementById('slot-machine');
  machine.classList.add('crazy-blink');
  setTimeout(() => machine.classList.remove('crazy-blink'), 2000);
}

  }
});
  

if (totalWin > 0) {
  if (Math.random() < 0.05) {
    totalWin *= 2;
    winMessages.push("ğŸ‰ í„°ì¡Œë‹¤!");
  }

  resultDisplay.textContent = `ğŸ‰ í„°ì¡Œë‹¤! ${winMessages.join(', ')}`;
  money += totalWin;

  // ğŸ”Š ë‹¹ì²¨ íš¨ê³¼ìŒ ì¬ìƒ
  bgm.pause();
  winSound.currentTime = 0;
  winSound.play().catch(() => {});

  // íš¨ê³¼ìŒ ëë‚˜ë©´ BGM ì¬ê°œ
  winSound.onended = () => {
    bgm.play().catch(() => {});
  };

    // âœ… ëª©í‘œ ì´ˆê³¼ ì‹œ ê³„ì† ìŠ¤í…Œì´ì§€ ìƒìŠ¹
  while (money >= target) {
    nextStage();
  }
} else {
  resultDisplay.textContent = 'ê½!';
}

    updateDisplay();
    if (money < minBet) gameOver();
    else spinButton.disabled = false;
  }, 1000);
}


    spinButton.addEventListener('click', () => {
      if (!bgmStarted) {
        bgm.play().catch(() => {});
        bgmStarted = true;
      }
      spin();
    });

    restartButton.addEventListener('click', () => {
      money = 100;
      stage = 1;
      target = 500;
      spinCount = 0;
      resultDisplay.textContent = '';
      spinButton.disabled = false;
      restartButton.style.display = 'none';
      initReels();
      updateDisplay();
    });

    initReels();
    updateDisplay();
  </script>
</body>
</html>
